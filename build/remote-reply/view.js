import*as e from"@wordpress/interactivity";var t,o,n={764:(t,o,n)=>{const r=(l={getConfig:()=>e.getConfig,getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store},s={},n.d(s,l),s);var l,s;const{apiFetch:a}=window.wp;!function(){const{actions:e,callbacks:t}=(0,r.store)("activitypub/remote-reply",{actions:{openModal(e){const o=(0,r.getContext)();o.modal.isOpen=!0,o.modal.isCompact?setTimeout(t.positionModal,0):setTimeout((()=>{const e=document.getElementById(o.blockId);if(e){const o=e.querySelector(".activitypub-modal__frame");o&&t.trapFocus(o)}}),50),"function"==typeof t.onModalOpen&&t.onModalOpen(e)},closeModal(e){const o=(0,r.getContext)();o.modal.isOpen=!1;const n=(0,r.getElement)();if("actions.toggleModal"===n.ref.dataset["wpOn-Click"])n.ref.focus();else{const e=document.getElementById(o.blockId);if(e){const t=e.querySelector('[data-wp-on--click="actions.toggleModal"], [data-wp-on-async--click="actions.toggleModal"]');t&&t.focus()}}"function"==typeof t.onModalClose&&t.onModalClose(e)},toggleModal(t){const{modal:o}=(0,r.getContext)();o.isOpen?e.closeModal(t):e.openModal(t)}},callbacks:{_abortController:null,handleModalEffects(){const{modal:e}=(0,r.getContext)();if(e.isOpen&&!e.isCompact?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),t._abortController&&(t._abortController.abort(),t._abortController=null),e.isOpen){t._abortController=new AbortController;const{signal:e}=t._abortController;document.addEventListener("keydown",t.documentKeydown,{signal:e}),document.addEventListener("click",t.documentClick,{signal:e})}},documentKeydown(t){const{modal:o}=(0,r.getContext)();o.isOpen&&"Escape"===t.key&&e.closeModal()},documentClick(t){const{blockId:o,modal:n}=(0,r.getContext)();if(!n.isOpen)return;const l=document.getElementById(o);if(!l)return;const s=l.querySelector('.wp-element-button[data-wp-on--click="actions.toggleModal"]');if(s&&(s===t.target||s.contains(t.target)))return;const a=l.querySelector(".activitypub-modal__frame");a&&!a.contains(t.target)&&e.closeModal()},positionModal(){const{blockId:e}=(0,r.getContext)(),t=document.getElementById(e);if(!t)return;const o=t.querySelector(".activitypub-modal__overlay");if(!o)return;o.style.top="",o.style.left="",o.style.right="",o.style.bottom="";const n=(0,r.getElement)().ref.getBoundingClientRect(),l=window.innerWidth,s=t.getBoundingClientRect();let a={top:n.bottom-s.top+8+"px",left:n.left-s.left-2+"px"};l-n.right<250&&(a.left="auto",a.right=s.right-n.right+"px"),Object.assign(o.style,a)},trapFocus(e){const t=e.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]):not([readonly]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),o=t[0],n=t[t.length-1];o&&o.classList.contains("activitypub-modal__close")&&t.length>1?t[1].focus():o.focus(),e.addEventListener("keydown",(function(e){"Tab"!==e.key&&9!==e.keyCode||(e.shiftKey?document.activeElement===o&&(n.focus(),e.preventDefault()):document.activeElement===n&&(o.focus(),e.preventDefault()))}))}}})}();const{actions:i,callbacks:c}=(0,r.store)("activitypub/remote-reply",{state:{get remoteProfileUrl(){const{commentURL:e,template:t}=(0,r.getContext)();return t.replace("{uri}",encodeURIComponent(e))}},actions:{onReplyLinkKeydown(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i.toggleModal(e))},copyToClipboard(){const e=(0,r.getContext)(),{i18n:t}=(0,r.getConfig)();navigator.clipboard.writeText(e.commentURL).then((()=>{e.copyButtonText=t.copied,setTimeout((()=>{e.copyButtonText=t.copy}),1e3)}),(e=>{console.error("Could not copy text: ",e)}))},updateRemoteProfile(e){const t=(0,r.getContext)();t.remoteProfile=e.target.value,t.isError=!1,t.errorMessage=""},onInputKeydown(e){if("Enter"===e.key)return e.preventDefault(),i.submitRemoteProfile()},*submitRemoteProfile(){const e=(0,r.getContext)(),{namespace:t,i18n:o}=(0,r.getConfig)(),n=e.remoteProfile.trim();if(!n)return e.isError=!0,void(e.errorMessage=o.emptyProfileError);if(!c.isHandle(n)&&!c.isUrl(n))return e.isError=!0,void(e.errorMessage=o.invalidProfileError);e.isLoading=!0,e.isError=!1,e.errorMessage="";const l=`/${t}/comments/${e.commentId}/remote-reply?resource=${encodeURIComponent(n)}`;try{const{template:t,url:o}=yield a({path:l});e.isLoading=!1,window.open(o,"_blank"),i.closeModal(),e.shouldSaveProfile&&(c.setStore({profileURL:n,template:t}),Object.assign(e,{hasRemoteUser:!0,profileURL:n,template:t}))}catch(t){console.error("Error submitting profile:",t),e.isLoading=!1,e.isError=!0,e.errorMessage=t.message||o.genericError}},toggleRememberProfile(){const e=(0,r.getContext)();e.shouldSaveProfile=!e.shouldSaveProfile},deleteRemoteUser(){const e=(0,r.getContext)();c.deleteStore(),e.hasRemoteUser=!1,e.profileURL="",e.template=""}},callbacks:{storageKey:"fediverse-remote-user",init(){const e=(0,r.getContext)(),{profileURL:t,template:o}=c.getStore();t&&o&&Object.assign(e,{hasRemoteUser:!0,profileURL:t,template:o})},getStore(){const e=localStorage.getItem(c.storageKey);return e?JSON.parse(e):{}},setStore(e){localStorage.setItem(c.storageKey,JSON.stringify(e))},deleteStore(){localStorage.removeItem(c.storageKey)},isHandle(e){const t=e.replace(/^@/,"").split("@");return 2===t.length&&c.isUrl(`https://${t[1]}`)},isUrl(e){try{return new URL(e),!0}catch(e){return!1}}}})}},r={};function l(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e](o,o.exports,l),o.exports}l.m=n,t=[],l.O=(e,o,n,r)=>{if(!o){var s=1/0;for(d=0;d<t.length;d++){for(var[o,n,r]=t[d],a=!0,i=0;i<o.length;i++)(!1&r||s>=r)&&Object.keys(l.O).every((e=>l.O[e](o[i])))?o.splice(i--,1):(a=!1,r<s&&(s=r));if(a){t.splice(d--,1);var c=n();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[o,n,r]},l.d=(e,t)=>{for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o={466:0,354:0},l.O.j=e=>0===o[e];var s=l.O(void 0,[354],(()=>l(764)));s=l.O(s);