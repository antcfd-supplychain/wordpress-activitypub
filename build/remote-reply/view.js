import{getConfig as e,getContext as t,getElement as o,store as r}from"@wordpress/interactivity";var n,l={764:()=>{const{apiFetch:n}=window.wp;!function(){const{actions:e,callbacks:n}=r("activitypub/remote-reply",{actions:{openModal(e){const o=t();o.modal.isOpen=!0,o.modal.isCompact?setTimeout(n.positionModal,0):setTimeout(()=>{const e=document.getElementById(o.blockId);if(e){const t=e.querySelector(".activitypub-modal__frame");t&&n.trapFocus(t)}},50),"function"==typeof n.onModalOpen&&n.onModalOpen(e)},closeModal(e){const r=t();r.modal.isOpen=!1;const l=o();if("actions.toggleModal"===l.ref.dataset["wpOn-Click"])l.ref.focus();else{const e=document.getElementById(r.blockId);if(e){const t=e.querySelector('[data-wp-on--click="actions.toggleModal"], [data-wp-on-async--click="actions.toggleModal"]');t&&t.focus()}}"function"==typeof n.onModalClose&&n.onModalClose(e)},toggleModal(o){const{modal:r}=t();r.isOpen?e.closeModal(o):e.openModal(o)}},callbacks:{_abortController:null,handleModalEffects(){const{modal:e}=t();if(e.isOpen&&!e.isCompact?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),n._abortController&&(n._abortController.abort(),n._abortController=null),e.isOpen){n._abortController=new AbortController;const{signal:e}=n._abortController;document.addEventListener("keydown",n.documentKeydown,{signal:e}),document.addEventListener("click",n.documentClick,{signal:e})}},documentKeydown(o){const{modal:r}=t();r.isOpen&&"Escape"===o.key&&e.closeModal()},documentClick(o){const{blockId:r,modal:n}=t();if(!n.isOpen)return;const l=document.getElementById(r);if(!l)return;const s=l.querySelector('.wp-element-button[data-wp-on--click="actions.toggleModal"]');if(s&&(s===o.target||s.contains(o.target)))return;const a=l.querySelector(".activitypub-modal__frame");a&&!a.contains(o.target)&&e.closeModal()},positionModal(){const{blockId:e}=t(),r=document.getElementById(e);if(!r)return;const n=r.querySelector(".activitypub-modal__overlay");if(!n)return;n.style.top="",n.style.left="",n.style.right="",n.style.bottom="";const l=o().ref.getBoundingClientRect(),s=window.innerWidth,a=r.getBoundingClientRect();let i={top:l.bottom-a.top+8+"px",left:l.left-a.left-2+"px"};s-l.right<250&&(i.left="auto",i.right=a.right-l.right+"px"),Object.assign(n.style,i)},trapFocus(e){const t=e.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]):not([readonly]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),o=t[0],r=t[t.length-1];o&&o.classList.contains("activitypub-modal__close")&&t.length>1?t[1].focus():o.focus(),e.addEventListener("keydown",function(e){"Tab"!==e.key&&9!==e.keyCode||(e.shiftKey?document.activeElement===o&&(r.focus(),e.preventDefault()):document.activeElement===r&&(o.focus(),e.preventDefault()))})}}})}();const{actions:l,callbacks:s,state:a}=r("activitypub/remote-reply",{state:{get remoteProfileUrl(){const{commentURL:e}=t();return a.template.replace("{uri}",encodeURIComponent(e))}},actions:{onReplyLinkKeydown(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l.toggleModal(e))},copyToClipboard(){const o=t(),{i18n:r}=e();navigator.clipboard.writeText(o.commentURL).then(()=>{o.copyButtonText=r.copied,setTimeout(()=>{o.copyButtonText=r.copy},1e3)},e=>{console.error("Could not copy text: ",e)})},updateRemoteProfile(e){const o=t();o.remoteProfile=e.target.value,o.isError=!1,o.errorMessage=""},onInputKeydown(e){if("Enter"===e.key)return e.preventDefault(),l.submitRemoteProfile()},*submitRemoteProfile(){const o=t(),{namespace:r,i18n:i}=e(),c=o.remoteProfile.trim();if(!c)return o.isError=!0,void(o.errorMessage=i.emptyProfileError);if(!s.isHandle(c)&&!s.isUrl(c))return o.isError=!0,void(o.errorMessage=i.invalidProfileError);o.isLoading=!0,o.isError=!1,o.errorMessage="";const d=`/${r}/comments/${o.commentId}/remote-reply?resource=${encodeURIComponent(c)}`;try{const{template:e,url:t}=yield n({path:d});o.isLoading=!1,window.open(t,"_blank"),l.closeModal(),o.shouldSaveProfile&&(s.setStore({profileURL:c,template:e}),Object.assign(a,{hasRemoteUser:!0,profileURL:c,template:e}))}catch(e){console.error("Error submitting profile:",e),o.isLoading=!1,o.isError=!0,o.errorMessage=e.message||i.genericError}},toggleRememberProfile(){const e=t();e.shouldSaveProfile=!e.shouldSaveProfile},deleteRemoteUser(){s.deleteStore(),a.hasRemoteUser=!1,a.profileURL="",a.template=""}},callbacks:{storageKey:"fediverse-remote-user",init(){const{profileURL:e,template:t}=s.getStore();e&&t&&Object.assign(a,{hasRemoteUser:!0,profileURL:e,template:t})},getStore(){const e=localStorage.getItem(s.storageKey);return e?JSON.parse(e):{}},setStore(e){localStorage.setItem(s.storageKey,JSON.stringify(e))},deleteStore(){localStorage.removeItem(s.storageKey)},isHandle(e){const t=e.replace(/^@/,"").split("@");return 2===t.length&&s.isUrl(`https://${t[1]}`)},isUrl(e){try{return new URL(e),!0}catch(e){return!1}}}})}},s={};function a(e){var t=s[e];if(void 0!==t)return t.exports;var o=s[e]={exports:{}};return l[e](o,o.exports,a),o.exports}a.m=l,n=[],a.O=(e,t,o,r)=>{if(!t){var l=1/0;for(d=0;d<n.length;d++){for(var[t,o,r]=n[d],s=!0,i=0;i<t.length;i++)(!1&r||l>=r)&&Object.keys(a.O).every(e=>a.O[e](t[i]))?t.splice(i--,1):(s=!1,r<l&&(l=r));if(s){n.splice(d--,1);var c=o();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=n.length;d>0&&n[d-1][2]>r;d--)n[d]=n[d-1];n[d]=[t,o,r]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i,c=a;export{c as __webpack_require__};i={466:0,354:0},a.C=e=>{var t,o,{__webpack_esm_ids__:r,__webpack_esm_modules__:n,__webpack_esm_runtime__:l}=e,s=0;for(t in n)a.o(n,t)&&(a.m[t]=n[t]);for(l&&l(a);s<r.length;s++)o=r[s],a.o(i,o)&&i[o]&&i[o][0](),i[r[s]]=0;a.O()},a.O.j=e=>0===i[e];var d=a.O(void 0,[354],()=>a(764));d=a.O(d);