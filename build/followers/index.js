(()=>{"use strict";var e,t={454:(e,t,s)=>{const a=window.wp.blocks,r=window.ReactJSXRuntime,l=window.wp.primitives;var i=(0,r.jsx)(l.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,r.jsx)(l.Path,{d:"M15.5 9.5a1 1 0 100-2 1 1 0 000 2zm0 1.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-2.25 6v-2a2.75 2.75 0 00-2.75-2.75h-4A2.75 2.75 0 003.75 15v2h1.5v-2c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v2h1.5zm7-2v2h-1.5v-2c0-.69-.56-1.25-1.25-1.25H15v-1.5h2.5A2.75 2.75 0 0120.25 15zM9.5 8.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",fillRule:"evenodd"})});const o=[{attributes:{title:{type:"string",default:"Fediverse Followers"},selectedUser:{type:"string",default:"blog"},per_page:{type:"number",default:10},order:{type:"string",default:"desc",enum:["asc","desc"]}},supports:{html:!1},isEligible:({title:e})=>!!e,migrate:({title:e,...t})=>[t,[(0,a.createBlock)("core/heading",{content:e,level:3})]]}],n=window.wp.apiFetch;var c=s.n(n);const p=window.wp.components,u=window.wp.blockEditor,d=window.wp.coreData,v=window.wp.data,h=window.wp.element,g=window.wp.url,w=window.wp.i18n;function f(){return window._activityPubOptions||{}}function b({name:e}){const{enabled:t}=f(),s=t?.blog?"":(0,w.__)("It will be empty in other non-author contexts.","activitypub"),a=(0,w.sprintf)(/* translators: %1$s: block name, %2$s: extra information for non-author context */ /* translators: %1$s: block name, %2$s: extra information for non-author context */
(0,w.__)("This <strong>%1$s</strong> block will adapt to the page it is on, displaying the user profile associated with a post author (in a loop) or a user archive. %2$s","activitypub"),e,s).trim();return(0,r.jsx)(p.Card,{children:(0,r.jsx)(p.CardBody,{children:(0,h.createInterpolateElement)(a,{strong:(0,r.jsx)("strong",{})})})})}function m({selectedUser:e,per_page:t,order:s,page:a,setPage:l,followerData:i=!1}){const o="blog"===e?0:e,[n,p]=(0,h.useState)([]),[u,d]=(0,h.useState)(0),[v,b]=(0,h.useState)(0),[m,y]=(0,h.useState)(1),j=a||m,N=l||y,k=(e,s)=>{p(e),b(s),d(Math.ceil(s/t))};return(0,h.useEffect)(()=>{if(i&&1===j)return k(i.followers,i.total);const e=function(e,t,s,a){const{namespace:r}=f(),l=`/${r}/actors/${e}/followers`,i={per_page:t,order:s,page:a,context:"full"};return(0,g.addQueryArgs)(l,i)}(o,t,s,j);c()({path:e}).then(({orderedItems:e,totalItems:t})=>k(e,t)).catch(()=>k([],0))},[o,t,s,j,i]),(0,r.jsxs)("div",{className:"followers-container",children:[n.length?(0,r.jsx)("ul",{className:"followers-list",children:n.map(e=>(0,r.jsx)("li",{className:"follower-item",children:(0,r.jsx)(_,{...e})},e.url))}):(0,r.jsx)("p",{className:"followers-placeholder",children:(0,w.__)("No followers found.","activitypub")}),(0,r.jsx)(x,{page:j,pages:u,setPage:N})]})}function x({page:e,pages:t,setPage:s}){if(t<=1)return null;const a=e<=1,l=e>=t;return(0,r.jsxs)("nav",{className:"followers-pagination",role:"navigation",children:[(0,r.jsx)("h1",{className:"screen-reader-text",children:(0,w.__)("Follower navigation","activitypub")}),(0,r.jsx)("a",{className:"pagination-previous","aria-disabled":a,"aria-label":(0,w.__)("Previous page","activitypub"),onClick:t=>{t.preventDefault(),s(e-1)},children:(0,w.__)("Previous","activitypub")}),(0,r.jsx)("div",{className:"pagination-info",children:`${e} / ${t}`}),(0,r.jsx)("a",{className:"pagination-next","aria-disabled":l,"aria-label":(0,w.__)("Next page","activitypub"),onClick:t=>{t.preventDefault(),s(e+1)},children:(0,w.__)("Next","activitypub")})]})}function _({name:e,icon:t,url:s,preferredUsername:a}){const l=`@${a}`,{defaultAvatarUrl:i}=f(),o=t?.url||i;return(0,r.jsxs)("a",{className:"follower-link",href:s,title:l,onClick:e=>e.preventDefault(),children:[(0,r.jsx)("img",{width:"48",height:"48",src:o,className:"follower-avatar",alt:e,onError:e=>{e.target.src=i}}),(0,r.jsxs)("div",{className:"follower-info",children:[(0,r.jsx)("span",{className:"follower-name",children:e}),(0,r.jsx)("span",{className:"follower-username",children:l})]}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",className:"external-link-icon","aria-hidden":"true",focusable:"false",fill:"currentColor",children:(0,r.jsx)("path",{d:"M18.2 17c0 .7-.6 1.2-1.2 1.2H7c-.7 0-1.2-.6-1.2-1.2V7c0-.7.6-1.2 1.2-1.2h3.2V4.2H7C5.5 4.2 4.2 5.5 4.2 7v10c0 1.5 1.2 2.8 2.8 2.8h10c1.5 0 2.8-1.2 2.8-2.8v-3.6h-1.5V17zM14.9 3v1.5h3.7l-6.4 6.4 1.1 1.1 6.4-6.4v3.7h1.5V3h-6.3z"})})]})}const y=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","name":"activitypub/followers","apiVersion":3,"version":"2.0.1","title":"Fediverse Followers","category":"widgets","description":"Display your followers from the Fediverse on your website.","textdomain":"activitypub","icon":"groups","supports":{"html":false,"interactivity":true},"attributes":{"selectedUser":{"type":"string","default":"blog"},"per_page":{"type":"number","default":10},"order":{"type":"string","default":"desc","enum":["asc","desc"]}},"usesContext":["postType","postId"],"styles":[{"name":"default","label":"Default","isDefault":true},{"name":"card","label":"Card"},{"name":"compact","label":"Compact"}],"editorScript":"file:./index.js","editorStyle":"file:./index.css","viewScriptModule":"file:./view.js","viewScript":"wp-api-fetch","style":["file:./style-index.css"],"render":"file:./render.php"}');(0,a.registerBlockType)(y,{deprecated:o,edit:function({attributes:e,setAttributes:t,context:{postType:s,postId:a}}){const{className:l="",order:i,per_page:o,selectedUser:n}=e,g=(0,u.useBlockProps)(),[x,_]=(0,h.useState)(1),y=[{label:(0,w.__)("New to old","activitypub"),value:"desc"},{label:(0,w.__)("Old to new","activitypub"),value:"asc"}],j=function({withInherit:e=!1}){const{enabled:t,namespace:s}=f(),[a,r]=(0,h.useState)(!1),{fetchedUsers:l,isLoadingUsers:i}=(0,v.useSelect)(e=>{const{getUsers:s,getIsResolving:a}=e("core");return{fetchedUsers:t?.users?s({capabilities:"activitypub"}):null,isLoadingUsers:!!t?.users&&a("getUsers",[{capabilities:"activitypub"}])}},[]),o=(0,v.useSelect)(e=>l||i?null:e("core").getCurrentUser(),[l,i]);(0,h.useEffect)(()=>{l||i||!o||c()({path:`/${s}/actors/${o.id}`,method:"HEAD",headers:{Accept:"application/activity+json"},parse:!1}).then(()=>r(!0)).catch(()=>r(!1))},[l,i,o]);const n=l||(o&&a?[{id:o.id,name:o.name}]:[]);return(0,h.useMemo)(()=>{if(!n.length)return[];const s=[];return t?.blog&&l&&s.push({label:(0,w.__)("Blog","activitypub"),value:"blog"}),e&&t?.users&&l&&s.push({label:(0,w.__)("Dynamic User","activitypub"),value:"inherit"}),n.reduce((e,t)=>(e.push({label:t.name,value:`${t.id}`}),e),s)},[n])}({withInherit:!0}),N=e=>s=>{_(1),t({[e]:s})},k=(0,v.useSelect)(e=>{const{getEditedEntityRecord:t}=e(d.store),r=t("postType",s,a)?.author;return null!=r?r:null},[s,a]);(0,h.useEffect)(()=>{j.length&&(j.find(({value:e})=>e===n)||t({selectedUser:j[0].value}))},[n,j]);const S=[["core/heading",{level:3,placeholder:(0,w.__)("Fediverse Followers","activitypub"),content:(0,w.__)("Fediverse Followers","activitypub")}]];return(0,r.jsxs)("div",{...g,children:[(0,r.jsx)(u.InspectorControls,{children:(0,r.jsxs)(p.PanelBody,{title:(0,w.__)("Followers Options","activitypub"),children:[j.length>1&&(0,r.jsx)(p.SelectControl,{label:(0,w.__)("Select User","activitypub"),value:n,options:j,onChange:N("selectedUser"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,r.jsx)(p.SelectControl,{label:(0,w.__)("Sort","activitypub"),value:i,options:y,onChange:N("order"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,r.jsx)(p.RangeControl,{label:(0,w.__)("Number of Followers","activitypub"),value:o,onChange:N("per_page"),min:1,max:10,__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})]})},"setting"),(0,r.jsxs)("div",{className:"wp-block-activitypub-followers "+l,children:[(0,r.jsx)(u.InnerBlocks,{template:S,allowedBlocks:["core/heading"],templateLock:"all",renderAppender:!1}),"inherit"===n?k?(0,r.jsx)(m,{...e,page:x,setPage:_,selectedUser:k}):(0,r.jsx)(b,{name:(0,w.__)("Followers","activitypub")}):(0,r.jsx)(m,{...e,page:x,setPage:_})]})]})},save:function(){const e=u.useBlockProps.save(),t=u.useInnerBlocksProps.save(e);return(0,r.jsx)("div",{...t})},icon:i})}},s={};function a(e){var r=s[e];if(void 0!==r)return r.exports;var l=s[e]={exports:{}};return t[e](l,l.exports,a),l.exports}a.m=t,e=[],a.O=(t,s,r,l)=>{if(!s){var i=1/0;for(p=0;p<e.length;p++){for(var[s,r,l]=e[p],o=!0,n=0;n<s.length;n++)(!1&l||i>=l)&&Object.keys(a.O).every(e=>a.O[e](s[n]))?s.splice(n--,1):(o=!1,l<i&&(i=l));if(o){e.splice(p--,1);var c=r();void 0!==c&&(t=c)}}return t}l=l||0;for(var p=e.length;p>0&&e[p-1][2]>l;p--)e[p]=e[p-1];e[p]=[s,r,l]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={149:0,17:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var r,l,[i,o,n]=s,c=0;if(i.some(t=>0!==e[t])){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);if(n)var p=n(a)}for(t&&t(s);c<i.length;c++)l=i[c],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(p)},s=globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=a.O(void 0,[17],()=>a(454));r=a.O(r)})();