(()=>{"use strict";var e,t={157:(e,t,i)=>{const r=window.wp.blocks,s=window.wp.i18n,l=window.wp.blockEditor,n=window.wp.components,a=window.wp.data,o=window.wp.element,c=window.wp.apiFetch;var d=i.n(c);function u(){return window._activityPubOptions||{}}const p=window.ReactJSXRuntime,h=JSON.parse('{"UU":"activitypub/extra-fields"}');(0,r.registerBlockType)(h.UU,{edit:function({attributes:e,setAttributes:t,context:i}){const{selectedUser:r,maxFields:c}=e,{postId:h,postType:v}=null!=i?i:{},[b,y]=(0,o.useState)([]),[f,x]=(0,o.useState)(!1),[g,w]=(0,o.useState)(null),m=(0,a.useSelect)(e=>{const t=e("core/editor"),i=e("core");if(h&&v&&i){var r,s;const e=null!==(r=i.getEditedEntityRecord?.("postType",v,h))&&void 0!==r?r:null;if(e?.author)return e.author;const t=null!==(s=i.getEntityRecord?.("postType",v,h))&&void 0!==s?s:null;if(t?.author)return t.author}return t&&t.getCurrentPostAttribute?t.getCurrentPostAttribute("author"):null},[h,v]),_="blog"===r?0:"inherit"===r?m||null:r,{namespace:j="activitypub/1.0",profileUrls:k={}}=u(),U="blog"===r?k.blog:k.user,F=(0,l.useBlockProps)({className:"activitypub-extra-fields-block-wrapper"}),C=function({withInherit:e=!1}){const{enabled:t,namespace:i}=u(),[r,l]=(0,o.useState)(!1),{fetchedUsers:n,isLoadingUsers:c}=(0,a.useSelect)(e=>{const{getUsers:i,getIsResolving:r}=e("core");return{fetchedUsers:t?.users?i({capabilities:"activitypub"}):null,isLoadingUsers:!!t?.users&&r("getUsers",[{capabilities:"activitypub"}])}},[]),p=(0,a.useSelect)(e=>n||c?null:e("core").getCurrentUser(),[n,c]);(0,o.useEffect)(()=>{n||c||!p||d()({path:`/${i}/actors/${p.id}`,method:"HEAD",headers:{Accept:"application/activity+json"},parse:!1}).then(()=>l(!0)).catch(()=>l(!1))},[n,c,p]);const h=n||(p&&r?[{id:p.id,name:p.name}]:[]);return(0,o.useMemo)(()=>{if(!h.length)return[];const i=[];return t?.blog&&n&&i.push({label:(0,s.__)("Blog","activitypub"),value:"blog"}),e&&t?.users&&n&&i.push({label:(0,s.__)("Dynamic User","activitypub"),value:"inherit"}),h.reduce((e,t)=>(e.push({label:t.name,value:`${t.id}`}),e),i)},[h])}({withInherit:!0});(0,o.useEffect)(()=>{null!==_?(x(!0),w(null),d()({path:`/${j}/actors/${_}`,headers:{Accept:"application/activity+json"}}).then(e=>{const t=(e.attachment||[]).filter(e=>"PropertyValue"===e.type);y(t),x(!1)}).catch(e=>{w(e.message),x(!1)})):y([])},[_,j]);const O=c>0?b.slice(0,c):b,E=(()=>{const t=e.className?.includes("is-style-cards");if(!t)return{};const i=e.style||{},r=e.backgroundColor,s=i.color?.background;return r?{backgroundColor:`var(--wp--preset--color--${r})`}:s?{backgroundColor:s}:{}})(),S=(0,p.jsx)(l.InspectorControls,{children:(0,p.jsxs)(n.PanelBody,{title:(0,s.__)("Settings","activitypub"),initialOpen:!0,children:[(0,p.jsx)(n.SelectControl,{label:(0,s.__)("User","activitypub"),value:r,options:C,onChange:e=>t({selectedUser:e})}),(0,p.jsx)(n.RangeControl,{label:(0,s.__)("Maximum Fields","activitypub"),value:c,onChange:e=>t({maxFields:e}),min:0,max:20,help:(0,s.__)("Limit the number of fields displayed. 0 = show all.","activitypub")})]})});return"inherit"!==r||m?f?(0,p.jsx)("div",{...F,children:(0,p.jsx)(n.Placeholder,{label:(0,s.__)("Fediverse Extra Fields","activitypub"),children:(0,p.jsx)(n.Spinner,{})})}):g?(0,p.jsx)("div",{...F,children:(0,p.jsx)(n.Placeholder,{label:(0,s.__)("Fediverse Extra Fields","activitypub"),children:(0,p.jsx)("p",{children:(0,s.sprintf)(/* translators: %s: Error message */ /* translators: %s: Error message */
(0,s.__)("Error loading extra fields: %s","activitypub"),g)})})}):0===O.length?(0,p.jsxs)(p.Fragment,{children:[S,(0,p.jsx)("div",{...F,children:(0,p.jsx)(n.Placeholder,{label:(0,s.__)("Fediverse Extra Fields","activitypub"),children:(0,p.jsxs)("p",{children:[(0,s.__)("No extra fields found.","activitypub")," ",U&&(0,p.jsx)(n.Button,{variant:"link",onClick:()=>{window.location.href=U},children:(0,s.__)("Add fields in your profile settings","activitypub")})]})})})]}):(0,p.jsxs)(p.Fragment,{children:[S,(0,p.jsx)("div",{...F,children:(0,p.jsx)("dl",{className:"activitypub-extra-fields",children:O.map(e=>(0,p.jsxs)("div",{className:"activitypub-extra-field",style:E,children:[(0,p.jsx)("dt",{children:e.name}),(0,p.jsx)("dd",{dangerouslySetInnerHTML:{__html:e.value}})]},`${e.name}-${e.value}`))})})]}):(0,p.jsxs)(p.Fragment,{children:[S,(0,p.jsx)("div",{...F,children:(0,p.jsx)(n.Placeholder,{label:(0,s.__)("Fediverse Extra Fields","activitypub"),children:(0,p.jsx)("p",{children:(0,s.__)("This block will display extra fields based on the post author when published.","activitypub")})})})]})},save:()=>null})}},i={};function r(e){var s=i[e];if(void 0!==s)return s.exports;var l=i[e]={exports:{}};return t[e](l,l.exports,r),l.exports}r.m=t,e=[],r.O=(t,i,s,l)=>{if(!i){var n=1/0;for(d=0;d<e.length;d++){for(var[i,s,l]=e[d],a=!0,o=0;o<i.length;o++)(!1&l||n>=l)&&Object.keys(r.O).every(e=>r.O[e](i[o]))?i.splice(o--,1):(a=!1,l<n&&(n=l));if(a){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[i,s,l]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={914:0,678:0};r.O.j=t=>0===e[t];var t=(t,i)=>{var s,l,[n,a,o]=i,c=0;if(n.some(t=>0!==e[t])){for(s in a)r.o(a,s)&&(r.m[s]=a[s]);if(o)var d=o(r)}for(t&&t(i);c<n.length;c++)l=n[c],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return r.O(d)},i=globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var s=r.O(void 0,[678],()=>r(157));s=r.O(s)})();