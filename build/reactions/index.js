(()=>{"use strict";var e,t={343:(e,t,r)=>{const n=window.wp.blocks,i=[{attributes:{title:{type:"string",default:"Fediverse reactions"}},supports:{html:!1,color:{gradients:!0,link:!0,__experimentalDefaultControls:{background:!0,text:!0,link:!0}},__experimentalBorder:{radius:!0,width:!0,color:!0,style:!0},typography:{fontSize:!0,__experimentalDefaultControls:{fontSize:!0}}},isEligible:({title:e})=>!!e,migrate:({title:e,...t})=>[t,[(0,n.createBlock)("core/heading",{content:e,level:6})]]}],s=window.wp.blockEditor,a=window.wp.i18n,o=window.wp.data,l=window.wp.element,c=window.wp.components,u=window.wp.apiFetch;var d=r.n(u);function p(){return window._activityPubOptions||{}}const f=window.ReactJSXRuntime,m=({reactions:e})=>{const{defaultAvatarUrl:t}=p();return(0,f.jsx)("ul",{className:"reaction-avatars",children:e.map((e,r)=>{const n=["reaction-avatar"].filter(Boolean).join(" "),i=e.avatar||t;return(0,f.jsx)("li",{children:(0,f.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,f.jsx)("img",{src:i,alt:e.name,className:n,width:"32",height:"32",onError:e=>{e.target.src=t}})})},r)})})},h=({reactions:e})=>{const{defaultAvatarUrl:t}=p();return(0,f.jsx)("ul",{className:"reactions-list",children:e.map((e,r)=>{const n=e.avatar||t;return(0,f.jsx)("li",{className:"reaction-item",children:(0,f.jsxs)("a",{href:e.url,className:"reaction-item",target:"_blank",rel:"noopener noreferrer",children:[(0,f.jsx)("img",{src:n,alt:e.name,width:"32",height:"32",onError:e=>{e.target.src=t}}),(0,f.jsx)("span",{className:"reaction-name",children:e.name})]})},r)})})},v=({items:e,label:t})=>{const[r,n]=(0,l.useState)(!1),[i,s]=(0,l.useState)(null),a=(0,l.useRef)(null),o=e.slice(0,20);return(0,f.jsxs)("div",{className:"reaction-group",ref:a,children:[(0,f.jsx)(m,{reactions:o}),(0,f.jsx)(c.Button,{ref:s,className:"reaction-label is-link",onClick:()=>n(!r),"aria-expanded":r,children:t}),r&&i&&(0,f.jsx)(c.Popover,{anchor:i,onClose:()=>n(!1),children:(0,f.jsx)(h,{reactions:e})})]})};function w({postId:e=null,reactions:t=null,fallbackReactions:r=null}){const{namespace:n}=p(),[i,s]=(0,l.useState)(t),[a,o]=(0,l.useState)(!t),c=()=>{r&&s(r),o(!1)};return(0,l.useEffect)(()=>{if(t)return s(t),void o(!1);e&&"number"==typeof e?(o(!0),d()({path:`/${n}/posts/${e}/reactions`}).then(e=>{const t=Object.values(e).some(e=>e.items?.length>0);s(!t&&r?r:e),o(!1)}).catch(c)):c()},[e,t,r,n]),a?null:i&&Object.values(i).some(e=>e.items?.length>0)?(0,f.jsx)(f.Fragment,{children:Object.entries(i).map(([e,t])=>t.items?.length?(0,f.jsx)(v,{items:t.items,label:t.label},e):null)}):null}const g=(e,t,r,n)=>Array.from({length:e},(e,i)=>({name:`${t} ${i+1}`,url:"#",avatar:`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%23${n[i%n.length]}'/%3E%3Ctext x='32' y='38' font-family='sans-serif' font-size='24' fill='white' text-anchor='middle'%3E${String.fromCharCode(r+i)}%3C/text%3E%3C/svg%3E`})),x=["FF6B6B","4ECDC4","45B7D1","96CEB4","D4A5A5","9B59B6","3498DB","E67E22"],b={likes:{label:(0,a.sprintf)(/* translators: %d: Number of likes */ /* translators: %d: Number of likes */
(0,a._x)("%d likes","number of likes","activitypub"),9),items:g(9,"User",65,x)},reposts:{label:(0,a.sprintf)(/* translators: %d: Number of reposts */ /* translators: %d: Number of reposts */
(0,a._x)("%d reposts","number of reposts","activitypub"),6),items:g(6,"Reposter",82,x)}},y=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","name":"activitypub/reactions","apiVersion":3,"version":"3.0.3","title":"Fediverse Reactions","category":"widgets","icon":"heart","description":"Display Fediverse likes and reposts","supports":{"align":["wide","full"],"color":{"gradients":true},"__experimentalBorder":{"radius":true,"width":true,"color":true,"style":true},"html":false,"interactivity":true,"layout":{"default":{"type":"constrained","orientation":"vertical","justifyContent":"center"},"allowEditing":false},"shadow":true,"typography":{"fontSize":true,"__experimentalDefaultControls":{"fontSize":true}}},"blockHooks":{"core/post-content":"after"},"textdomain":"activitypub","editorScript":"file:./index.js","style":"file:./style-index.css","viewScriptModule":"file:./view.js","viewScript":"wp-api-fetch","render":"file:./render.php"}');(0,n.registerBlockType)(y,{deprecated:i,edit:function({__unstableLayoutClassNames:e}){const t=(0,s.useBlockProps)({className:e}),{getCurrentPostId:r}=(0,o.select)("core/editor"),n=[["core/heading",{level:6,placeholder:(0,a.__)("Fediverse Reactions","activitypub"),content:(0,a.__)("Fediverse Reactions","activitypub")}]];return(0,f.jsxs)("div",{...t,children:[(0,f.jsx)(s.InnerBlocks,{template:n,allowedBlocks:["core/heading"],templateLock:"all",renderAppender:!1}),(0,f.jsx)(w,{postId:r(),fallbackReactions:b})]})},save:function(){return(0,f.jsx)("div",{...s.useBlockProps.save(),children:(0,f.jsx)(s.InnerBlocks.Content,{})})}})}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,r,i,s)=>{if(!r){var a=1/0;for(u=0;u<e.length;u++){for(var[r,i,s]=e[u],o=!0,l=0;l<r.length;l++)(!1&s||a>=s)&&Object.keys(n.O).every(e=>n.O[e](r[l]))?r.splice(l--,1):(o=!1,s<a&&(a=s));if(o){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,i,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={608:0,104:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var i,s,[a,o,l]=r,c=0;if(a.some(t=>0!==e[t])){for(i in o)n.o(o,i)&&(n.m[i]=o[i]);if(l)var u=l(n)}for(t&&t(r);c<a.length;c++)s=a[c],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},r=globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var i=n.O(void 0,[104],()=>n(343));i=n.O(i)})();