import{getConfig as e,getContext as t,getElement as o,store as n}from"@wordpress/interactivity";const r={computedStyles:null,variables:{}};function l(e){if("undefined"==typeof window||!window.getComputedStyle)return!1;if(r.variables.hasOwnProperty(e))return r.variables[e];r.computedStyles||(r.computedStyles=window.getComputedStyle(document.documentElement));const t=r.computedStyles.getPropertyValue(e).trim();return r.variables[e]=""!==t,r.variables[e]}function c(e){if("string"!=typeof e)return null;if(e.match(/^#/))return e.substring(0,7);const[,,t]=e.split("|"),o=`--wp--preset--color--${t}`;return l(o)?`var(${o})`:null}function i(e,t,o=null,n=""){return o?`${e}${n} { ${t}: ${o}; }\n`:""}function s(e,t,o,n){return i(e,"background-color",t)+i(e,"color",o)+i(e,"background-color",n,":hover")+i(e,"background-color",n,":focus")}const{apiFetch:a}=window.wp;!function(){const{actions:e,callbacks:r}=n("activitypub/follow-me",{actions:{openModal(e){const o=t();o.modal.isOpen=!0,o.modal.isCompact?setTimeout(r.positionModal,0):setTimeout(()=>{const e=document.getElementById(o.blockId);if(e){const t=e.querySelector(".activitypub-modal__frame");t&&r.trapFocus(t)}},50),"function"==typeof r.onModalOpen&&r.onModalOpen(e)},closeModal(e){const n=t();n.modal.isOpen=!1;const l=o();if("actions.toggleModal"===l.ref.dataset["wpOn-Click"])l.ref.focus();else{const e=document.getElementById(n.blockId);if(e){const t=e.querySelector('[data-wp-on--click="actions.toggleModal"], [data-wp-on-async--click="actions.toggleModal"]');t&&t.focus()}}"function"==typeof r.onModalClose&&r.onModalClose(e)},toggleModal(o){const{modal:n}=t();n.isOpen?e.closeModal(o):e.openModal(o)}},callbacks:{_abortController:null,handleModalEffects(){const{modal:e}=t();if(e.isOpen&&!e.isCompact?document.body.classList.add("modal-open"):document.body.classList.remove("modal-open"),r._abortController&&(r._abortController.abort(),r._abortController=null),e.isOpen){r._abortController=new AbortController;const{signal:e}=r._abortController;document.addEventListener("keydown",r.documentKeydown,{signal:e}),document.addEventListener("click",r.documentClick,{signal:e})}},documentKeydown(o){const{modal:n}=t();n.isOpen&&"Escape"===o.key&&e.closeModal()},documentClick(o){const{blockId:n,modal:r}=t();if(!r.isOpen)return;const l=document.getElementById(n);if(!l)return;const c=l.querySelector('.wp-element-button[data-wp-on--click="actions.toggleModal"]');if(c&&(c===o.target||c.contains(o.target)))return;const i=l.querySelector(".activitypub-modal__frame");i&&!i.contains(o.target)&&e.closeModal()},positionModal(){const{blockId:e}=t(),n=document.getElementById(e);if(!n)return;const r=n.querySelector(".activitypub-modal__overlay");if(!r)return;r.style.top="",r.style.left="",r.style.right="",r.style.bottom="";const l=o().ref.getBoundingClientRect(),c=window.innerWidth,i=n.getBoundingClientRect();let s={top:l.bottom-i.top+8+"px",left:l.left-i.left-2+"px"};c-l.right<250&&(s.left="auto",s.right=i.right-l.right+"px"),Object.assign(r.style,s)},trapFocus(e){const t=e.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]):not([readonly]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),o=t[0],n=t[t.length-1];o&&o.classList.contains("activitypub-modal__close")&&t.length>1?t[1].focus():o.focus(),e.addEventListener("keydown",function(e){"Tab"!==e.key&&9!==e.keyCode||(e.shiftKey?document.activeElement===o&&(n.focus(),e.preventDefault()):document.activeElement===n&&(o.focus(),e.preventDefault()))})}}})}();const{actions:d,callbacks:u}=n("activitypub/follow-me",{actions:{copyToClipboard(){const o=t(),{i18n:n}=e();navigator.clipboard.writeText(o.webfinger).then(()=>{o.copyButtonText=n.copied,setTimeout(()=>{o.copyButtonText=n.copy},1e3)},e=>{console.error("Could not copy text: ",e)})},updateRemoteProfile(e){const o=t();o.remoteProfile=e.target.value,o.isError=!1,o.errorMessage=""},onKeydown(e){"A"!==o().ref.tagName||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),d.toggleModal(e))},handleKeyDown(e){"Enter"===e.key&&(e.preventDefault(),d.submitRemoteProfile())},submitRemoteProfile:function*(){const o=t(),{namespace:n,i18n:r}=e(),l=o.remoteProfile.trim();if(!l)return o.isError=!0,void(o.errorMessage=r.emptyProfileError);if(!u.isHandle(l))return o.isError=!0,void(o.errorMessage=r.invalidProfileError);o.isLoading=!0,o.isError=!1;const c=`/${n}/actors/${o.userId}/remote-follow?resource=${encodeURIComponent(l)}`;try{const e=yield a({path:c});o.isLoading=!1,window.open(e.url,"_blank"),d.closeModal(new Event("click"))}catch(e){console.error("Error submitting profile:",e),o.isLoading=!1,o.isError=!0,o.errorMessage=e.message||r.genericError}}},callbacks:{initButtonStyles:()=>{const{buttonStyle:e,backgroundColor:o,blockId:n}=t();if(n&&e){const t=document.createElement("style"),i=`#${n}`;t.textContent=function(e,t,o){const n=`${e} .wp-block-button__link`,r=function(e){if("string"==typeof e){const t=`--wp--preset--color--${e}`;return l(t)?`var(${t})`:null}return e?.color?.background||null}(o)||t?.color?.background;return s(n,c(t?.elements?.link?.color?.text),r,c(t?.elements?.link?.[":hover"]?.color?.text))}(i,e,o),document.head.appendChild(t);const a=document.createElement("style");a.textContent=(r=e,s(".activitypub-dialog__button-group .wp-block-button",c(r?.elements?.link?.color?.text)||"#111","#fff",c(r?.elements?.link?.[":hover"]?.color?.text)||"#333")),document.head.appendChild(a)}var r},isHandle(e){const t=e.replace(/^@/,"").split("@");return 2===t.length&&u.isUrl(`https://${t[1]}`)},isUrl(e){try{return new URL(e),!0}catch(e){return!1}},onModalClose(){t().isError=!1}}});