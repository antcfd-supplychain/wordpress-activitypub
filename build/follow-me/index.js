(()=>{var e,t={768:(e,t,r)=>{"use strict";const o=window.wp.blocks,s=window.wp.primitives,i=window.ReactJSXRuntime,n=(0,i.jsx)(s.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(s.Path,{d:"M15.5 9.5a1 1 0 100-2 1 1 0 000 2zm0 1.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-2.25 6v-2a2.75 2.75 0 00-2.75-2.75h-4A2.75 2.75 0 003.75 15v2h1.5v-2c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v2h1.5zm7-2v2h-1.5v-2c0-.69-.56-1.25-1.25-1.25H15v-1.5h2.5A2.75 2.75 0 0120.25 15zM9.5 8.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",fillRule:"evenodd"})});var a=r(942),l=r.n(a);const c=window.wp.blockEditor,u=window.wp.i18n,p={html:!1,color:{gradients:!0,link:!0,__experimentalDefaultControls:{background:!0,text:!0,link:!0}},__experimentalBorder:{radius:!0,width:!0,color:!0,style:!0},typography:{fontSize:!0,__experimentalDefaultControls:{fontSize:!0}}},d=p;function v({buttonOnly:e=!1,className:t="",...r}){return r.className=l()(t,e?"is-style-button-only":"is-style-default"),r}const f={attributes:{buttonOnly:{type:"boolean",default:!1},buttonText:{type:"string",default:"Follow"},selectedUser:{type:"string",default:"blog"}},supports:p,isEligible:({buttonText:e,buttonOnly:t})=>!!e||!!t,migrate({buttonText:e,...t}){const r=(0,o.createBlock)("core/button",{text:e});return[v(t),[r]]}},b={attributes:{selectedUser:{type:"string",default:"blog"},buttonOnly:{type:"boolean",default:!1}},supports:d,isEligible:({buttonOnly:e})=>!!e,migrate:v,save(){const e=c.useBlockProps.save(),t=c.useInnerBlocksProps.save(e);return(0,i.jsx)("div",{...t})}},h=[{attributes:{selectedUser:{type:"string",default:"blog"}},supports:d,isEligible:(e,t)=>1===t.length&&"button"===t[0].attributes.tagName,migrate(e,t){var r;const{tagName:s,...i}=t[0].attributes,n=null!==(r=t[0].originalContent.replace(/<[^>]*>/g,""))&&void 0!==r?r:(0,u.__)("Follow","activitypub");return[e,[(0,o.createBlock)("core/button",{...i,text:n})]]},save(){const e=c.useBlockProps.save(),t=c.useInnerBlocksProps.save(e);return(0,i.jsx)("div",{...t})}},b,f],y=window.wp.apiFetch;var w=r.n(y);const m=window.wp.data,g=window.wp.coreData,_=window.wp.components,x=window.wp.element;function j(){return window._activityPubOptions||{}}function k({name:e}){const{enabled:t}=j(),r=t?.blog?"":(0,u.__)("It will be empty in other non-author contexts.","activitypub"),o=(0,u.sprintf)(/* translators: %1$s: block name, %2$s: extra information for non-author context */ /* translators: %1$s: block name, %2$s: extra information for non-author context */
(0,u.__)("This <strong>%1$s</strong> block will adapt to the page it is on, displaying the user profile associated with a post author (in a loop) or a user archive. %2$s","activitypub"),e,r).trim();return(0,i.jsx)(_.Card,{children:(0,i.jsx)(_.CardBody,{children:(0,x.createInterpolateElement)(o,{strong:(0,i.jsx)("strong",{})})})})}const B={avatar:"https://secure.gravatar.com/avatar/default?s=120",webfinger:"@well@hello.dolly",name:(0,u.__)("Hello Dolly Fan Account","activitypub"),url:"#",image:{url:""},summary:""};function S(e){if(!e)return B;const t={...B,...e};return t.avatar=t?.icon?.url,t.webfinger&&!t.webfinger.startsWith("@")&&(t.webfinger="@"+t.webfinger),t}function O({profile:e,className:t,innerBlocksProps:r}){const{webfinger:o,avatar:s,name:n,image:a,summary:l,followersCount:c,postsCount:p}=e,d=t&&t.includes("is-style-button-only"),v={posts:p||0,followers:c||0};return(0,i.jsxs)("div",{className:"activitypub-profile",children:[!d&&a?.url&&(0,i.jsx)("div",{className:"activitypub-profile__header",style:{backgroundImage:`url(${a.url})`}}),(0,i.jsxs)("div",{className:"activitypub-profile__body",children:[!d&&(0,i.jsx)("img",{className:"activitypub-profile__avatar",src:s,alt:n}),(0,i.jsxs)("div",{className:"activitypub-profile__content",children:[!d&&(0,i.jsxs)("div",{className:"activitypub-profile__info",children:[(0,i.jsx)("div",{className:"activitypub-profile__name",children:n}),(0,i.jsx)("div",{className:"activitypub-profile__handle",children:o})]}),(0,i.jsx)("div",{...r}),!d&&(0,i.jsx)("div",{className:"activitypub-profile__bio",dangerouslySetInnerHTML:{__html:l}}),!d&&(0,i.jsx)("div",{className:"activitypub-profile__stats",children:Object.entries(v).map(([e,t])=>(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:t})," ","posts"===e?(0,u._n)("post","posts",t,"activitypub"):"followers"===e?(0,u._n)("follower","followers",t,"activitypub"):(0,u._n)("following","following",t,"activitypub")]},e))})]})]})]})}const N=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","name":"activitypub/follow-me","apiVersion":3,"version":"2.2.0","title":"Follow me on the Fediverse","category":"widgets","description":"Display your Fediverse profile so that visitors can follow you.","textdomain":"activitypub","icon":"groups","example":{"attributes":{"className":"is-style-default"}},"supports":{"html":false,"interactivity":true,"color":{"gradients":true,"link":true,"__experimentalDefaultControls":{"background":true,"text":true,"link":true}},"__experimentalBorder":{"radius":true,"width":true,"color":true,"style":true},"shadow":true,"typography":{"fontSize":true,"__experimentalDefaultControls":{"fontSize":true}},"innerBlocks":{"allowedBlocks":["core/button"]}},"styles":[{"name":"default","label":"Default","isDefault":true},{"name":"button-only","label":"Button"},{"name":"profile","label":"Profile"}],"attributes":{"selectedUser":{"type":"string","default":"blog"}},"usesContext":["postType","postId"],"editorScript":"file:./index.js","viewScriptModule":"file:./view.js","viewScript":"wp-api-fetch","style":"file:./style-index.css","render":"file:./render.php"}');(0,o.registerBlockType)(N,{deprecated:h,edit:function({attributes:e,setAttributes:t,context:{postType:r,postId:o}}){const s=(0,c.useBlockProps)({className:"activitypub-follow-me-block-wrapper"}),n=function({withInherit:e=!1}){const{enabled:t,namespace:r}=j(),[o,s]=(0,x.useState)(!1),{fetchedUsers:i,isLoadingUsers:n}=(0,m.useSelect)(e=>{const{getUsers:r,getIsResolving:o}=e("core");return{fetchedUsers:t?.users?r({capabilities:"activitypub"}):null,isLoadingUsers:!!t?.users&&o("getUsers",[{capabilities:"activitypub"}])}},[]),a=(0,m.useSelect)(e=>i||n?null:e("core").getCurrentUser(),[i,n]);(0,x.useEffect)(()=>{i||n||!a||w()({path:`/${r}/actors/${a.id}`,method:"HEAD",headers:{Accept:"application/activity+json"},parse:!1}).then(()=>s(!0)).catch(()=>s(!1))},[i,n,a]);const l=i||(a&&o?[{id:a.id,name:a.name}]:[]);return(0,x.useMemo)(()=>{if(!l.length)return[];const r=[];return t?.blog&&i&&r.push({label:(0,u.__)("Blog","activitypub"),value:"blog"}),e&&t?.users&&i&&r.push({label:(0,u.__)("Dynamic User","activitypub"),value:"inherit"}),l.reduce((e,t)=>(e.push({label:t.name,value:`${t.id}`}),e),r)},[l])}({withInherit:!0}),{selectedUser:a,className:l="is-style-default"}=e,p="inherit"===a,[d,v]=(0,x.useState)(S(B)),f="blog"===a?0:a,b=[["core/button",{text:(0,u.__)("Follow","activitypub")}]],h=(0,c.useInnerBlocksProps)({},{allowedBlocks:["core/button"],template:b,templateLock:!1,renderAppender:!1}),y=(0,m.useSelect)(e=>{const{getEditedEntityRecord:t}=e(g.store),s=t("postType",r,o)?.author;return null!=s?s:null},[r,o]);return(0,x.useEffect)(()=>{if(p&&!y)return;const e=p?y:f;(function(e){const{namespace:t}=j(),r={headers:{Accept:"application/activity+json"},path:`/${t}/actors/${e}`};return w()(r)})(e).then(t=>{if(v(S(t)),t.followers)try{const{pathname:e}=new URL(t.followers);w()({path:e.replace("wp-json/","")}).then(({totalItems:e=0})=>{v(t=>({...t,followersCount:e}))}).catch(()=>{})}catch(e){}e?w()({path:`/wp/v2/users/${e}/?context=activitypub`}).then(({post_count:e})=>{v(t=>({...t,postsCount:e}))}).catch(()=>{}):w()({path:"/wp/v2/posts",method:"HEAD",parse:!1}).then(e=>{const t=e.headers.get("X-WP-Total");v(e=>({...e,postsCount:t}))}).catch(()=>{})}).catch(()=>{})},[f,y,p]),(0,x.useEffect)(()=>{n.length&&(n.find(({value:e})=>e===a)||t({selectedUser:n[0].value}))},[a,n]),(0,i.jsxs)("div",{...s,children:[(0,i.jsx)(c.InspectorControls,{children:n.length>1&&(0,i.jsx)(_.PanelBody,{title:(0,u.__)("Follow Me Options","activitypub"),children:(0,i.jsx)(_.SelectControl,{label:(0,u.__)("Select User","activitypub"),value:e.selectedUser,options:n,onChange:e=>t({selectedUser:e}),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0})})},"activitypub-follow-me"),p&&!y?(0,i.jsx)(k,{name:(0,u.__)("Follow Me","activitypub")}):(0,i.jsx)(O,{profile:d,className:l,innerBlocksProps:h})]})},icon:n,save:function(){const e=c.useBlockProps.save(),t=c.useInnerBlocksProps.save(e);return(0,i.jsx)("div",{...t})}})},942:(e,t)=>{var r;!function(){"use strict";var o={}.hasOwnProperty;function s(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];r&&(e=n(e,i(r)))}return e}function i(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return s.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var r in e)o.call(e,r)&&e[r]&&(t=n(t,r));return t}function n(e,t){return t?e?e+" "+t:e+t:e}e.exports?(s.default=s,e.exports=s):void 0===(r=function(){return s}.apply(t,[]))||(e.exports=r)}()}},r={};function o(e){var s=r[e];if(void 0!==s)return s.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,r,s,i)=>{if(!r){var n=1/0;for(u=0;u<e.length;u++){for(var[r,s,i]=e[u],a=!0,l=0;l<r.length;l++)(!1&i||n>=i)&&Object.keys(o.O).every(e=>o.O[e](r[l]))?r.splice(l--,1):(a=!1,i<n&&(n=i));if(a){e.splice(u--,1);var c=s();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[r,s,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={338:0,870:0};o.O.j=t=>0===e[t];var t=(t,r)=>{var s,i,[n,a,l]=r,c=0;if(n.some(t=>0!==e[t])){for(s in a)o.o(a,s)&&(o.m[s]=a[s]);if(l)var u=l(o)}for(t&&t(r);c<n.length;c++)i=n[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(u)},r=globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var s=o.O(void 0,[870],()=>o(768));s=o.O(s)})();